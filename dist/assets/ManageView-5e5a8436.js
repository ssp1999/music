import{_ as x,i as S,j as v,s as b,o as g,c as p,a as s,t as l,n as f,k as d,F,g as k,d as $,l as U,r as _,f as y,v as w,m as R,b as m,w as C,h as D}from"./index-b8e06ccb.js";const I={name:"UploadFile",data(){return{is_dragover:!1,uploads:[]}},props:["addSong"],methods:{upload(t){this.is_dragover=!1,(t.dataTransfer?[...t.dataTransfer.files]:[...t.target.files]).forEach(a=>{if(a.type!=="audio/mpeg")return;if(!navigator.onLine){this.uploads.push({task:{},current_progress:100,name:a.name,variant:"bg-red-400",icon:"fas fa-times",text_class:"text-red-400"});return}const r=S.ref().child(`songs/${a.name}`).put(a),o=this.uploads.push({task:r,current_progress:0,name:a.name,variant:"bg-blue-400",icon:"fas fa-spinner fa-spin",text_class:""})-1;r.on("state_changed",i=>{const c=i.bytesTransferred/i.totalBytes*100;this.uploads[o].current_progress=c},i=>{this.uploads[o].variant="bg-red-400",this.uploads[o].icon="fa fa-times",this.uploads[o].text_class="text-red-400",console.log(i)},async()=>{const i={uid:v.currentUser.uid,display_name:v.currentUser.displayName,original_name:r.snapshot.ref.name,modified_name:r.snapshot.ref.name,genre:"",comment_count:0};i.url=await r.snapshot.ref.getDownloadURL();const u=await(await b.add(i)).get();this.addSong(u),this.uploads[o].variant="bg-green-400",this.uploads[o].icon="fa fa-check",this.uploads[o].text_class="text-green-400"})})}},beforeUnmount(){this.uploads.forEach(t=>{t.task.cancel()})}},q={class:"bg-white rounded border border-gray-200 relative flex flex-col"},N={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},V={class:"card-title"},B=s("i",{class:"fas fa-upload float-right text-green-400 text-2xl"},null,-1),E={class:"p-6"},L=s("hr",{class:"my-6"},null,-1),T={class:"flex h-4 overflow-hidden bg-gray-200 rounded"};function M(t,e,a,h,n,r){return g(),p("div",null,[s("div",q,[s("div",N,[s("span",V,l(t.$t("manage.upload")),1),B]),s("div",E,[s("div",{class:f(["w-full px-10 py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-green-400 hover:border-green-400 hover:border-solid",{"bg-green-400 border-green-400 border-solid":n.is_dragover}]),onDrag:e[0]||(e[0]=d(()=>{},["prevent","stop"])),onDragstart:e[1]||(e[1]=d(()=>{},["prevent","stop"])),onDragend:e[2]||(e[2]=d(o=>n.is_dragover=!1,["prevent","stop"])),onDragover:e[3]||(e[3]=d(o=>n.is_dragover=!0,["prevent","stop"])),onDragenter:e[4]||(e[4]=d(o=>n.is_dragover=!0,["prevent","stop"])),onDragleave:e[5]||(e[5]=d(o=>n.is_dragover=!1,["prevent","stop"])),onDrop:e[6]||(e[6]=d(o=>r.upload(o),["prevent","stop"]))},[s("h5",null,l(t.$t("manage.drop")),1)],34),s("input",{type:"file",multiple:"",onChange:e[7]||(e[7]=o=>r.upload(o))},null,32),L,(g(!0),p(F,null,k(n.uploads,o=>(g(),p("div",{class:"mb-4",key:o.name},[s("div",{class:f(["font-bold text-sm",o.text_class])},[s("i",{class:f(o.icon)},null,2),$(" "+l(o.name),1)],2),s("div",T,[s("div",{class:f(["transition-all progress-bar bg-blue-400",o.variant]),style:U({width:o.current_progress+"%"})},null,6)])]))),128))])])])}const j=x(I,[["render",M]]),z={name:"CompositionItem",props:{song:{type:Object,required:!0},updateSong:{type:Function,required:!0},index:{type:Number,required:!0},removeSong:{type:Function,required:!0},updateUnsavedFlag:{type:Function,required:!0}},data(){return{showForm:!1,schema:{modified_name:"required",genre:"required"},in_submission:!1,show_alert:!1,alert_variant:"bg-blue-500",alert_message:"Please wait, updating song info."}},methods:{async edit(t){this.in_submission=!0,this.show_alert=!0,this.alert_variant="bg-blue-500",this.alert_message="Please wait, updating song info.";try{await b.doc(this.song.docId).update(t)}catch{this.in_submission=!1,this.alert_variant="bg-red-500",this.alert_message="Something went wrong, please try again.";return}this.updateSong(this.index,t),this.updateUnsavedFlag(!1),this.in_submission=!1,this.alert_variant="bg-green-500",this.alert_message="Success!"},async deleteSong(){await S.ref().child(`songs/${this.song.original_name}`).delete(),await b.doc(this.song.docId).delete(),this.removeSong(this.index)}}},P={class:"border border-gray-200 p-3 mb-4 rounded"},O={class:"inline-block text-2xl font-bold"},Y=s("i",{class:"fa fa-times"},null,-1),A=[Y],G=s("i",{class:"fa fa-pencil-alt"},null,-1),H=[G],J={class:"mb-3"},K={class:"inline-block mb-2"},Q={class:"mb-3"},W={class:"inline-block mb-2"},X=["disabled"],Z=["disabled"];function ee(t,e,a,h,n,r){const o=_("vee-field"),i=_("error-message"),c=_("vee-form");return g(),p("div",null,[s("div",P,[y(s("div",null,[s("h4",O,l(a.song.modified_name),1),s("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-red-600 float-right",onClick:e[0]||(e[0]=d((...u)=>r.deleteSong&&r.deleteSong(...u),["prevent"]))},A),s("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-blue-600 float-right",onClick:e[1]||(e[1]=d(u=>n.showForm=!n.showForm,["prevent"]))},H)],512),[[w,!n.showForm]]),y(s("div",null,[n.show_alert?(g(),p("div",{key:0,class:f(["text-white text-center font-bold p-4 mb-4",n.alert_variant])},l(n.alert_message),3)):R("",!0),m(c,{onSubmit:r.edit,"validation-schema":n.schema},{default:C(()=>[s("div",J,[s("label",K,l(t.$t("composition.title")),1),m(o,{type:"text",name:"modified_name",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:t.$t("composition.title"),onInput:e[2]||(e[2]=u=>a.updateUnsavedFlag(!0))},null,8,["placeholder"]),m(i,{class:"text-red-600",name:"modified_name"})]),s("div",Q,[s("label",W,l(t.$t("composition.genre")),1),m(o,{type:"text",name:"genre",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:t.$t("composition.genre"),onInput:e[3]||(e[3]=u=>a.updateUnsavedFlag(!0))},null,8,["placeholder"]),m(i,{class:"text-red-600",name:"genre"})]),s("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600",disabled:n.in_submission},l(t.$t("buttons.submit")),9,X),s("button",{type:"button",class:"py-1.5 px-3 rounded text-white bg-gray-600",disabled:n.in_submission,onClick:e[4]||(e[4]=d(u=>n.showForm=!1,["prevent"]))},l(t.$t("buttons.back")),9,Z)]),_:1},8,["onSubmit","validation-schema"])],512),[[w,n.showForm]])])])}const se=x(z,[["render",ee]]),te={name:"ManageView",components:{UploadFile:j,CompositionItem:se},data(){return{songs:[],unsavedFlag:!1}},async created(){(await b.where("uid","==",v.currentUser.uid).get()).forEach(this.addSong)},methods:{updateSong(t,e){this.songs[t].modified_name=e.modified_name,this.songs[t].genre=e.genre},removeSong(t){this.songs.splice(t,1)},addSong(t){const e={...t.data(),docId:t.id};this.songs.push(e)},updateUnsavedFlag(t){this.unsavedFlag=t}},beforeRouteLeave(t,e,a){if(!this.unsavedFlag)a();else{const h=confirm("You have unsaved changes, are you sure you want to leave?");a(h)}}},oe={class:"container mx-auto mt-6"},ne={class:"md:grid md:grid-cols-3 md:gap-4"},re={class:"col-span-1"},ae={class:"col-span-2"},ie={class:"bg-white rounded border border-gray-200 relative flex flex-col"},de={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},le={class:"card-title"},ue=s("i",{class:"fa fa-compact-disc float-right text-green-400 text-2xl"},null,-1),ge={class:"p-6"};function ce(t,e,a,h,n,r){const o=_("upload-file"),i=_("composition-item");return g(),p("div",null,[s("section",oe,[s("div",ne,[s("div",re,[m(o,{addSong:r.addSong},null,8,["addSong"])]),s("div",ae,[s("div",ie,[s("div",de,[s("span",le,l(t.$t("manage.my_songs")),1),ue]),s("div",ge,[(g(!0),p(F,null,k(n.songs,(c,u)=>(g(),D(i,{key:c.docId,song:c,updateSong:r.updateSong,index:u,removeSong:r.removeSong,updateUnsavedFlag:r.updateUnsavedFlag},null,8,["song","updateSong","index","removeSong","updateUnsavedFlag"]))),128))])])])])])])}const me=x(te,[["render",ce]]);export{me as default};
