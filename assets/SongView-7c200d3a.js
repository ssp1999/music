import{_ as w,p as v,u as x,s as u,q as k,x as C,j as _,y as h,r as d,o as i,c as l,a as e,k as S,t as n,n as P,m as g,h as D,w as q,b,f as U,z as V,F as z,g as B}from"./index-0bd90296.js";const I={name:"SongView",data(){return{song:{},schema:{comment:"required|min:3"},comment_in_submission:!1,comment_show_alert:!1,comment_alert_variant:"bg-blue-500",comment_alert_msg:"Please wait, your comment is being submitted.",comments:[],sort:"1"}},computed:{...v(x,["userLoggedIn"]),sortedComments(){return this.comments.slice().sort((t,o)=>this.sort==="1"?new Date(o.datePosted)-new Date(t.datePosted):new Date(t.datePosted)-new Date(o.datePosted))}},async beforeRouteEnter(t,o,c){const m=await u.doc(t.params.id).get();c(s=>{if(!m.exists){s.$router.push({name:"home"});return}const{sort:a}=s.$route.query;s.sort=a==="1"||a==="2"?a:"1",s.song=m.data(),s.getComments()})},methods:{...k(C,["newSong"]),async addComment(t,{resetForm:o}){this.comment_in_submission=!0,this.comment_show_alert=!0,this.comment_alert_variant="bg-blue-500",this.comment_alert_msg="Please wait, your comment is being submitted.";const c={songId:this.$route.params.id,content:t.comment,datePosted:new Date().toString(),author:_.currentUser.displayName,authorUid:_.currentUser.uid};try{await h.add(c),this.song.comment_count+=1,await u.doc(this.$route.params.id).update({comment_count:this.song.comment_count})}catch{this.comment_in_submission=!1,this.comment_alert_variant="bg-red-500",this.comment_alert_msg="Some error ocurred, try again later."}this.comment_in_submission=!1,this.comment_alert_variant="bg-green-500",this.comment_alert_msg="Comment added successfully!",o(),this.getComments()},async getComments(){const t=await h.where("songId","==",this.$route.params.id).get();this.comments=[],t.forEach(o=>{this.comments.push({id:o.id,...o.data()})})}},watch:{sort(t){t!=this.$route.query.sort&&this.$router.push({query:{sort:t}})}}},N={class:"w-full mb-8 py-14 text-center text-white relative"},$=e("div",{class:"absolute inset-0 w-full h-full box-border bg-contain music-bg",style:{"background-image":"url(/music/assets/img/song-header.png)"}},null,-1),E={class:"container mx-auto flex items-center"},L=e("i",{class:"fas fa-play"},null,-1),F=[L],M={class:"z-50 text-left ml-8"},j={class:"text-3xl font-bold"},A={class:"song-price"},R={class:"container mx-auto mt-6",id:"comments"},G={class:"bg-white rounded border border-gray-200 relative flex flex-col"},H={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},J={class:"card-title"},K=e("i",{class:"fa fa-comments float-right text-green-400 text-2xl"},null,-1),O={class:"p-6"},Q=["disabled"],T={value:"1"},W={value:"2"},X={class:"container mx-auto"},Y={class:"mb-5"},Z={class:"font-bold"};function ee(t,o,c,m,s,a){const p=d("vee-field"),f=d("error-message"),y=d("vee-form");return i(),l("main",null,[e("section",N,[$,e("div",E,[e("button",{id:"play-btn",type:"button",class:"z-50 h-24 w-24 text-3xl bg-white text-black rounded-full focus:outline-none",onClick:o[0]||(o[0]=S(r=>t.newSong(s.song),["prevent"]))},F),e("div",M,[e("div",j,n(s.song.modified_name),1),e("div",null,n(s.song.genre),1),e("div",A,n(t.$n(1,"currency")),1)])])]),e("section",R,[e("div",G,[e("div",H,[e("span",J,n(t.$tc("song.comment_count",s.song.comment_count,{count:s.song.comment_count})),1),K]),e("div",O,[s.comment_show_alert?(i(),l("div",{key:0,class:P(["text-white text-center font-bold p-4 mb-4",s.comment_alert_variant])},n(s.comment_alert_msg),3)):g("",!0),t.userLoggedIn?(i(),D(y,{key:1,onSubmit:a.addComment,"validation-schema":s.schema},{default:q(()=>[b(p,{as:"textarea",name:"comment",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded mb-4",placeholder:t.$t("placeholder.comment")},null,8,["placeholder"]),b(f,{class:"text-red-600",name:"comment"}),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 block",disabled:s.comment_in_submission},n(t.$t("buttons.submit")),9,Q)]),_:1},8,["onSubmit","validation-schema"])):g("",!0),U(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>s.sort=r),class:"block mt-4 py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded"},[e("option",T,n(t.$t("song.latest")),1),e("option",W,n(t.$t("song.oldest")),1)],512),[[V,s.sort]])])])]),e("ul",X,[(i(!0),l(z,null,B(a.sortedComments,r=>(i(),l("li",{class:"p-6 bg-gray-50 border border-gray-200",key:r.id},[e("div",Y,[e("div",Z,n(r.author),1),e("time",null,n(r.datePosted),1)]),e("p",null,n(r.content),1)]))),128))])])}const se=w(I,[["render",ee]]);export{se as default};
